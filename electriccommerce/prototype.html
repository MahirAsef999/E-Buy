<!DOCTYPE html>
<html>
<head>
  <title>E-Commerce</title>
  <meta charset="utf-8" />
  <style>
    /*Background color*/
    body {
      background-color: #c8f2c2;
      font-family: Arial, sans-serif;
      margin: 0;
    }
    /*Cart Button model*/
    #cartButton {
      position: fixed;
      top: 10px;
      right: 10px;
      background-color: transparent;
      border: none;
      cursor: pointer;
      z-index: 999;
    }

    #cartButton img {
      width: 50px;
      height: 50px;
    }

    #cartButton:hover img {
      transform: scale(1.1);
      transition: transform 0.2s ease-in-out;
    }

    /*Cart Image*/
    #cartBadge {
      position: absolute;
      top: -5px;
      right: -5px;
      background-color: #ff3333;
      color: white;
      border-radius: 50%;
      width: 25px;
      height: 25px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
      display: none;
    }

    #cartBadge.show {
      display: flex;
    }

    /*Modal overlay*/
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
      background-color: white;
      margin: 5% auto;
      padding: 20px;
      border: 1px solid #888;
      border-radius: 10px;
      width: 80%;
      max-width: 1000px;
      max-height: 80vh;
      overflow-y: auto;
      box-sizing: border-box;
      position: relative;
    }

    .close {
      color: #aaa;
      position: absolute;
      top: 12px;
      right: 16px;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }

    .close:hover,
    .close:focus {
      color: black;
    }

    /*Cart layout*/

    .cart-main-container{
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      gap: 20px;
      margin-top: 10px;
    }

    .products_container{
      background-color: white;
      width: 65%;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 150px;
    }

    .product-row{
      display: flex;
      flex-direction: row;
      align-items: center;
      width: 90%;
      min-height: 120px;
      border-bottom: 1px solid #ddd;
      padding: 20px 0;
    }

    .product_image{
      width: 90px;
      height: 80px;
      margin-right: 30px;
      flex-shrink: 0;
    }

    .product_image img{
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .product_description{
      flex: 1;
    }

    .product_description h3 {
      margin: 0 0 6px;
    }

    .product_price {
      margin-bottom: 8px;
      color: #555;
      font-size: 14px;
    }

    .count-container{
      display: flex;
      flex-direction: row;
      height: 27px;
      border: 1px solid black;
      border-radius: 6px;
      font-size: 20px;
    }

    .counter{
      width: 40px;
      border-left: 1px solid black;
      border-right: 1px solid black;
    }

    .subtract-counter,
    .add-counter{
      width: 26px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      user-select: none;
    }

    .subtract-counter:hover,
    .add-counter:hover{
      cursor: pointer;
      background-color: #f0f0f0;
    }

    .counter input{
      width: 100%;
      height: 100%;
      box-sizing: border-box;
      border: none;
      text-align: center;
      font-size: 16px;
      padding: 0;
      background: transparent;
    }

    .counter input:focus{
      outline: none;
    }

    .delete-product{
      align-self: flex-start;
      font-size: 2em;
      margin-left: 20px;
      cursor: pointer;
      margin-top: 10px;
      background: none;
      border: none;
    }

    .delete-product:hover{
      color: red;
    }

    .order-detail-container{
      background-color: white;
      width: 30%;
      height: fit-content;
      padding: 20px;
      box-sizing: border-box;
    }

    .order-summary-title{
      display: flex;
      flex-direction: column;
      align-items: center;
      border-bottom: 1px gray solid;
    }

    .order-summary-details{
      display: flex;
      flex-direction: column;
      gap: 5px;
      margin-top: 5px;
      border-bottom: 1px gray solid;
      padding: 3px;
      font-size: 14px;
    }

    .order-summary-total{
      font-weight: 600;
      margin: 10px 0 15px;
    }

    .order-summary-buttons{
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    #checkout{
      width: 100%;
      height: 40px;
      font-weight: 600;
      background-color: yellow;
      border-radius: 8px;
      border: 1px solid #333;
      cursor: pointer;
    }

    #continue-shopping{
      width: 100%;
      height: 40px;
      font-weight: 600;
      background-color: white;
      border-radius: 8px;
      border: 1px solid #333;
      cursor: pointer;
    }

    .empty-message {
      padding: 30px;
      color: #666;
    }

    .loading {
      text-align: center;
      padding: 20px;
      color: #666;
    }

    /*Product items*/
    #row1, #row2, #row3, #row4, #row5, #row6 {
      display: flex;
      gap: 8px;
      margin-top: 8px;
      padding: 0 20px;
    }

    /*Hover overlay on each product*/
    .product-card {
      position: relative;
      border: 1px solid #9ad69a;
      padding: 2px;
      background: #e4ffe4;
      cursor: pointer;
      overflow: hidden;
    }

    .product-card img {
      width: 10vw;
      height: 20vh;
      object-fit: cover;
      display: block;
    }

    .product-overlay {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      padding: 4px 6px;
      background: rgba(0, 0, 0, 0.75);
      color: #fff;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      gap: 6px;
      transform: translateY(100%);
      transition: transform 0.15s ease-in-out;
    }

    .product-card:hover .product-overlay {
      transform: translateY(0);
    }

    .product-name {
      font-weight: bold;
      margin-right: 3px;
    }

    .product-add-btn {
      border: 1px solid #ffd900;
      background: #ffd900;
      color: #000;
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 4px;
      cursor: pointer;
      white-space: nowrap;
    }

    .product-add-btn:hover {
      filter: brightness(0.95);
    }

    /*Product detail modal*/
    .product-modal-content {
      max-width: 700px;
    }

    .product-modal-body {
      display: flex;
      gap: 20px;
      align-items: flex-start;
      flex-wrap: wrap;
    }

    #modalProductImage {
      width: 220px;
      height: 220px;
      object-fit: cover;
      border: 1px solid #ddd;
    }

    .product-modal-info h2 {
      margin-top: 0;
    }

    .product-modal-price {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .product-modal-desc {
      font-size: 14px;
      margin-bottom: 15px;
    }

    .product-modal-actions {
      margin-top: 10px;
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .product-qty-input {
      width: 60px;
      padding: 4px;
      text-align: center;
    }

    .checkout-btn {
      background: #ffd900;
      border-radius: 5px;
      padding: 8px 16px;
      border: 1px solid #333;
      cursor: pointer;
      font-weight: 600;
    }

    .checkout-btn:hover {
      background: #ffcc00;
    }

    .secondary-btn {
      background: #fff;
      border-radius: 5px;
      padding: 8px 16px;
      border: 1px solid #ccc;
      cursor: pointer;
    }

    .secondary-btn:hover {
      background: #f5f5f5;
    }
  </style>
</head>
<body>
  <!-- Cart button -->
  <button id="cartButton" onclick="openCart()">
    <img src="https://png.pngtree.com/png-clipart/20190920/original/pngtree-shopping-cart-convenient-icon-png-image_4637407.jpg" alt="Shopping Cart"/>
    <div id="cartBadge">0</div>
  </button>

  <!-- Shopping cart -->
  <div id="cartModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeCart()">&times;</span>
      <h2>Shopping Cart</h2>

      <div class="cart-main-container">
        <!-- products -->
        <div id="cartProducts" class="products_container">
          <div class="empty-message">Loading cart...</div>
        </div>

        <!-- order summary -->
        <div class="order-detail-container">
          <div class="order-summary">
            <div class="order-summary-title">
              <h3>ORDER SUMMARY</h3>
            </div>
            <div class="order-summary-details">
              <div id="order-subtotal">Subtotal: $0</div>
              <div id="order-shipping">Shipping: $0</div>
              <div id="order-tax">Tax: $0</div>
            </div>
            <div class="order-summary-total">
              <p id="order-total">Total: $0</p>
            </div>
            <div class="order-summary-buttons">
              <button id="checkout" onclick="checkout()">Proceed to Secure Checkout</button>
              <button id="continue-shopping" onclick="closeCart()">Continue Shopping</button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Product detail -->
  <div id="productModal" class="modal">
    <div class="modal-content product-modal-content">
      <span class="close" onclick="closeProductModal()">&times;</span>
      <div class="product-modal-body">
        <img id="modalProductImage" src="" alt="Product image">
        <div class="product-modal-info">
          <h2 id="modalProductName"></h2>
          <div class="product-modal-price" id="modalProductPrice"></div>
          <p class="product-modal-desc">
            Work in Progress.
          </p>
          <div class="product-modal-actions">
            <label>Quantity:
              <input id="productQty" class="product-qty-input" type="number" min="1" value="1">
            </label>
            <button class="checkout-btn" onclick="addCurrentProductToCart()">Add to Cart</button>
            <button class="secondary-btn" onclick="closeProductModal()">Cancel</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <h1 style="padding-left:20px;">E-Buy</h1>
  <h2 style="padding-left:20px;">By Mahir, Kellen, Chinemerem, and Kira</h2>
  <h3 style="padding-left:20px;">Click an item to view details or add it to your cart.</h3>

  <!-- the products with hover titles -->
  <div id="row1">
    <div class="product-card" data-id="Refrigerator" data-name="Refrigerator" data-price="500">
      <img src="https://zlinekitchen.com/cdn/shop/products/zline--french--door--stainless--steel--standard--depth--refrigerator--RSM-W-36--side.jpg?v=1722276759&width=1946">
      <div class="product-overlay">
        <span class="product-name">Refrigerator</span>
        <span>$500</span>
        <button class="product-add-btn" onclick="event.stopPropagation(); myItem('Refrigerator',1);">Add</button>
      </div>
    </div>

    <div class="product-card" data-id="Microwave" data-name="Microwave" data-price="300">
      <img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6577/6577280_sd.jpg">
      <div class="product-overlay">
        <span class="product-name">Microwave</span>
        <span>$300</span>
        <button class="product-add-btn" onclick="event.stopPropagation(); myItem('Microwave',1);">Add</button>
      </div>
    </div>

    <div class="product-card" data-id="Dishwasher" data-name="Dishwasher" data-price="450">
      <img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/28f0ed55-0925-4cf5-92a1-cd8e15b2e4c3.jpg">
      <div class="product-overlay">
        <span class="product-name">Dishwasher</span>
        <span>$450</span>
        <button class="product-add-btn" onclick="event.stopPropagation(); myItem('Dishwasher',1);">Add</button>
      </div>
    </div>

    <div class="product-card" data-id="Oven" data-name="Oven" data-price="550">
      <img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6401/6401963_sd.jpg">
      <div class="product-overlay">
        <span class="product-name">Oven</span>
        <span>$550</span>
        <button class="product-add-btn" onclick="event.stopPropagation(); myItem('Oven',1);">Add</button>
      </div>
    </div>
  </div>
  <br>

  <div id="row2">
    <div class="product-card" data-id="Washer" data-name="Washer" data-price="600">
      <img src="https://encrypted-tbn1.gstatic.com/shopping?q=tbn:ANd9GcRHFP8zaZVxIWcSWSVep64sTKkNXpAUwjc1r-JWgSiIzJec9AgcXtD14uslJUbgiucfnOhAmOkk44xkEKsKSMy_WHA9SAY4XXaflYq8lY1uWl7Wiy_1T6ktrIrGudNit0ONXFR5PDuJX9s&usqp=CAc">
      <div class="product-overlay">
        <span class="product-name">Washer</span>
        <span>$600</span>
        <button class="product-add-btn" onclick="event.stopPropagation(); myItem('Washer',1);">Add</button>
      </div>
    </div>

    <div class="product-card" data-id="Dryer" data-name="Dryer" data-price="600">
      <img src="https://encrypted-tbn0.gstatic.com/shopping?q=tbn:ANd9GcTxzQsvZ5-0y3nx6SmTdPYKqHtnKtUoNMSj27WSABnLIHa0S5rUf3alGypWsHDaEbFhLNdhJOa0uz023MbufcB7e1CImjm-e1jw7hnxunPdJBvaYymoL6uTNEZqUroAiYtVF1jd340dP4I&usqp=CAc">
      <div class="product-overlay">
        <span class="product-name">Dryer</span>
        <span>$600</span>
        <button class="product-add-btn" onclick="event.stopPropagation(); myItem('Dryer',1);">Add</button>
      </div>
    </div>

    <div class="product-card" data-id="Blender" data-name="Blender" data-price="100">
      <img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6395/6395884_sd.jpg">
      <div class="product-overlay">
        <span class="product-name">Blender</span>
        <span>$100</span>
        <button class="product-add-btn" onclick="event.stopPropagation(); myItem('Blender',1);">Add</button>
      </div>
    </div>

    <div class="product-card" data-id="DripCoffee" data-name="Drip Coffee" data-price="150">
      <img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6553/6553385_sd.jpg">
      <div class="product-overlay">
        <span class="product-name">Drip Coffee</span>
        <span>$150</span>
        <button class="product-add-btn" onclick="event.stopPropagation(); myItem('DripCoffee',1);">Add</button>
      </div>
    </div>
  </div>
  <br>

  <div id="row3">
    <div class="product-card" data-id="Laptop" data-name="Laptop" data-price="200">
      <img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/189f8d5b-03fe-4d49-aa2b-552018e1c819.jpg">
      <div class="product-overlay">
        <span class="product-name">Laptop</span>
        <span>$200</span>
        <button class="product-add-btn" onclick="event.stopPropagation(); myItem('Laptop',1);">Add</button>
      </div>
    </div>

    <div class="product-card" data-id="TV" data-name="TV" data-price="399">
      <img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/0343bc5e-db43-4664-8ef1-8a7255eae875.jpg">
      <div class="product-overlay">
        <span class="product-name">TV</span>
        <span>$399</span>
        <button class="product-add-btn" onclick="event.stopPropagation(); myItem('TV',1);">Add</button>
      </div>
    </div>

    <div class="product-card" data-id="Speaker" data-name="Speakers" data-price="199">
      <img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/db2aafd7-3ca3-48e3-a7fe-36714093bf8c.jpg">
      <div class="product-overlay">
        <span class="product-name">Speakers</span>
        <span>$199</span>
        <button class="product-add-btn" onclick="event.stopPropagation(); myItem('Speaker',1);">Add</button>
      </div>
    </div>

    <div class="product-card" data-id="OutDatedVinyl" data-name="Vinyl" data-price="50">
      <img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/a495cade-d7b5-4eb8-a36f-c378d3c29ec9.jpg">
      <div class="product-overlay">
        <span class="product-name">Vinyl</span>
        <span>$50</span>
        <button class="product-add-btn" onclick="event.stopPropagation(); myItem('OutDatedVinyl',1);">Add</button>
      </div>
    </div>
  </div>
  <br>

  <div id="row4">
    <div class="product-card" data-id="Switch2" data-name="Switch 2" data-price="499">
      <img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/2d2b885d-0b91-4a0a-b8e0-247fd2b26ab7.jpg">
      <div class="product-overlay">
        <span class="product-name">Switch 2</span>
        <span>$499</span>
        <button class="product-add-btn" onclick="event.stopPropagation(); myItem('Switch2',1);">Add</button>
      </div>
    </div>

    <div class="product-card" data-id="PlayStation5" data-name="PlayStation 5" data-price="599">
      <img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6601/6601524_sd.jpg">
      <div class="product-overlay">
        <span class="product-name">PlayStation 5</span>
        <span>$599</span>
        <button class="product-add-btn" onclick="event.stopPropagation(); myItem('PlayStation5',1);">Add</button>
      </div>
    </div>

    <div class="product-card" data-id="XboxS" data-name="Xbox Series S" data-price="399">
      <img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6470/6470289_sd.jpg">
      <div class="product-overlay">
        <span class="product-name">Xbox Series S</span>
        <span>$399</span>
        <button class="product-add-btn" onclick="event.stopPropagation(); myItem('XboxS',1);">Add</button>
      </div>
    </div>

    <div class="product-card" data-id="OutDatedGameBoy" data-name="Gameboy" data-price="1">
      <img src="https://upload.wikimedia.org/wikipedia/commons/7/7c/Game-Boy-FL.png">
      <div class="product-overlay">
        <span class="product-name">Gameboy</span>
        <span>$1</span>
        <button class="product-add-btn" onclick="event.stopPropagation(); myItem('OutDatedGameBoy',1);">Add</button>
      </div>
    </div>
  </div>
  <br>

  <div id="row5">
    <div class="product-card" data-id="Headphones" data-name="Headphones" data-price="49">
      <img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/4c7591bb-84b4-4697-b3a7-91ba2d6c83fa.jpg">
      <div class="product-overlay">
        <span class="product-name">Headphones</span>
        <span>$49</span>
        <button class="product-add-btn" onclick="event.stopPropagation(); myItem('Headphones',1);">Add</button>
      </div>
    </div>

    <div class="product-card" data-id="IPad" data-name="Tablet" data-price="299">
      <img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/2a76c272-cd12-43b9-ace9-34df9942ddd6.jpg">
      <div class="product-overlay">
        <span class="product-name">Tablet</span>
        <span>$299</span>
        <button class="product-add-btn" onclick="event.stopPropagation(); myItem('IPad',1);">Add</button>
      </div>
    </div>

    <div class="product-card" data-id="GamingDesktop" data-name="Gaming Desktop" data-price="999">
      <img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/08c4770e-4f55-494e-a8ed-6604c87bef73.jpg">
      <div class="product-overlay">
        <span class="product-name">Gaming Desktop</span>
        <span>$999</span>
        <button class="product-add-btn" onclick="event.stopPropagation(); myItem('GamingDesktop',1);">Add</button>
      </div>
    </div>

    <div class="product-card" data-id="Printer" data-name="Printer" data-price="230">
      <img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/02d42d73-c9c2-4f3a-a964-6d7d37a9f574.jpg">
      <div class="product-overlay">
        <span class="product-name">Printer</span>
        <span>$230</span>
        <button class="product-add-btn" onclick="event.stopPropagation(); myItem('Printer',1);">Add</button>
      </div>
    </div>
  </div>
  <br>

  <div id="row6">
    <div class="product-card" data-id="Monitor" data-name="Computer Monitor" data-price="750">
      <img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6208cafc-fd04-4b29-89a5-4b431fde8df7.jpg">
      <div class="product-overlay">
        <span class="product-name">Computer Monitor</span>
        <span>$750</span>
        <button class="product-add-btn" onclick="event.stopPropagation(); myItem('Monitor',1);">Add</button>
      </div>
    </div>

    <div class="product-card" data-id="Camera" data-name="Camera" data-price="700">
      <img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6536/6536336_sd.jpg">
      <div class="product-overlay">
        <span class="product-name">Camera</span>
        <span>$700</span>
        <button class="product-add-btn" onclick="event.stopPropagation(); myItem('Camera',1);">Add</button>
      </div>
    </div>

    <div class="product-card" data-id="SmartWatch" data-name="Smart Watch" data-price="299">
      <img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/9ac5d1ec-3b32-4adb-a2f5-adc8b3c047e9.jpg">
      <div class="product-overlay">
        <span class="product-name">Smart Watch</span>
        <span>$299</span>
        <button class="product-add-btn" onclick="event.stopPropagation(); myItem('SmartWatch',1);">Add</button>
      </div>
    </div>

    <div class="product-card" data-id="Vaccum" data-name="Vacuum" data-price="100">
      <img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/30d1d685-9631-4dcb-b24a-27211cc47de2.jpg">
      <div class="product-overlay">
        <span class="product-name">Vacuum</span>
        <span>$100</span>
        <button class="product-add-btn" onclick="event.stopPropagation(); myItem('Vaccum',1);">Add</button>
      </div>
    </div>
  </div>

  <script>
    const API = "http://127.0.0.1:8000/api";
    const headers = { "Content-Type": "application/json", "x-demo-token": "student1" };

    async function api(path, opts = {}) {
      const res = await fetch(API + path, { headers, ...opts });
      if (!res.ok) throw new Error(await res.text());
      return res.json();
    }

    // Product images 
    const productImages = {
      Refrigerator: "https://zlinekitchen.com/cdn/shop/products/zline--french--door--stainless--steel--standard--depth--refrigerator--RSM-W-36--side.jpg?v=1722276759&width=1946",
      Microwave: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6577/6577280_sd.jpg",
      Dishwasher: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/28f0ed55-0925-4cf5-92a1-cd8e15b2e4c3.jpg",
      Oven: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6401/6401963_sd.jpg",
      Washer: "https://encrypted-tbn1.gstatic.com/shopping?q=tbn:ANd9GcRHFP8zaZVxIWcSWSVep64sTKkNXpAUwjc1r-JWgSiIzJec9AgcXtD14uslJUbgiucfnOhAmOkk44xkEKsKSMy_WHA9SAY4XXaflYq8lY1uWl7Wiy_1T6ktrIrGudNit0ONXFR5PDuJX9s&usqp=CAc",
      Dryer: "https://encrypted-tbn0.gstatic.com/shopping?q=tbn:ANd9GcTxzQsvZ5-0y3nx6SmTdPYKqHtnKtUoNMSj27WSABnLIHa0S5rUf3alGypWsHDaEbFhLNdhJOa0uz023MbufcB7e1CImjm-e1jw7hnxunPdJBvaYymoL6uTNEZqUroAiYtVF1jd340dP4I&usqp=CAc",
      Blender: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6395/6395884_sd.jpg",
      DripCoffee: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6553/6553385_sd.jpg",
      Laptop: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/189f8d5b-03fe-4d49-aa2b-552018e1c819.jpg",
      TV: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/0343bc5e-db43-4664-8ef1-8a7255eae875.jpg",
      Speaker: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/db2aafd7-3ca3-48e3-a7fe-36714093bf8c.jpg",
      OutDatedVinyl: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/a495cade-d7b5-4eb8-a36f-c378d3c29ec9.jpg",
      Switch2: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/2d2b885d-0b91-4a0a-b8e0-247fd2b26ab7.jpg",
      PlayStation5: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6601/6601524_sd.jpg",
      XboxS: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6470/6470289_sd.jpg",
      OutDatedGameBoy: "https://upload.wikimedia.org/wikipedia/commons/7/7c/Game-Boy-FL.png",
      Headphones: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/4c7591bb-84b4-4697-b3a7-91ba2d6c83fa.jpg",
      IPad: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/2a76c272-cd12-43b9-ace9-34df9942ddd6.jpg",
      GamingDesktop: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/08c4770e-4f55-494e-a8ed-6604c87bef73.jpg",
      Printer: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/02d42d73-c9c2-4f3a-a964-6d7d37a9f574.jpg",
      Monitor: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6208cafc-fd04-4b29-89a5-4b431fde8df7.jpg",
      Camera: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6536/6536336_sd.jpg",
      SmartWatch: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/9ac5d1ec-3b32-4adb-a2f5-adc8b3c047e9.jpg",
      Vaccum: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/30d1d685-9631-4dcb-b24a-27211cc47de2.jpg"
    };

    // update cart image
    async function updateCartBadge() {
      try {
        const cart = await api("/cart");
        const itemCount = cart.items.length;
        const badge = document.getElementById("cartBadge");

        if (itemCount > 0) {
          badge.textContent = itemCount;
          badge.classList.add("show");
        } else {
          badge.classList.remove("show");
        }
      } catch (e) {
        console.error("Badge update failed:", e);
      }
    }

    // Build cart rows in modal
    async function loadCart() {
      const container = document.getElementById("cartProducts");
      container.innerHTML = '<div class="empty-message">Loading cart...</div>';

      try {
        const cart = await api("/cart");

        if (!cart.items.length) {
          container.innerHTML = '<div class="empty-message">Your cart is empty.</div>';
          updateSummary(0);
          return;
        }

        container.innerHTML = "";
        cart.items.forEach(item => {
          container.appendChild(createProductRow(item));
        });

        updateSummary(cart.subtotal);
      } catch (e) {
        container.innerHTML = '<div class="empty-message">Error loading cart.</div>';
      }
    }

    function createProductRow(item) {
      const productId = item.productId;
      const price = item.price;
      const qty = item.qty;

      const row = document.createElement("div");
      row.className = "product-row";
      row.dataset.productId = productId;

      const imgDiv = document.createElement("div");
      imgDiv.className = "product_image";
      const img = document.createElement("img");
      img.alt = productId;
      img.src = productImages[productId] || "https://via.placeholder.com/80x80?text=Item";
      imgDiv.appendChild(img);

      const descDiv = document.createElement("div");
      descDiv.className = "product_description";

      const title = document.createElement("h3");
      title.textContent = productId;

      const priceDiv = document.createElement("div");
      priceDiv.className = "product_price";
      priceDiv.textContent = `$${price} each`;

      const countContainer = document.createElement("div");
      countContainer.className = "count-container";

      const minus = document.createElement("div");
      minus.className = "subtract-counter";
      minus.textContent = "-";

      const counter = document.createElement("div");
      counter.className = "counter";

      const input = document.createElement("input");
      input.type = "text";
      input.className = "quantity-input";
      input.value = qty;

      counter.appendChild(input);

      const plus = document.createElement("div");
      plus.className = "add-counter";
      plus.textContent = "+";

      countContainer.appendChild(minus);
      countContainer.appendChild(counter);
      countContainer.appendChild(plus);

      descDiv.appendChild(title);
      descDiv.appendChild(priceDiv);
      descDiv.appendChild(countContainer);

      const delBtn = document.createElement("button");
      delBtn.className = "delete-product";
      delBtn.innerHTML = "&times;";

      row.appendChild(imgDiv);
      row.appendChild(descDiv);
      row.appendChild(delBtn);

      // handlers
      minus.addEventListener("click", () => changeQty(productId, parseInt(input.value || "1", 10) - 1));
      plus.addEventListener("click", () => changeQty(productId, parseInt(input.value || "1", 10) + 1));
      delBtn.addEventListener("click", () => removeItem(productId));

      return row;
    }

    async function changeQty(productId, newQty) {
      if (newQty <= 0) {
        if (confirm("Remove this item from cart?")) {
          await removeItem(productId);
        }
        return;
      }
      try {
        await api(`/cart/items/${productId}`, {
          method: "PATCH",
          body: JSON.stringify({ qty: newQty })
        });
        await loadCart();
        await updateCartBadge();
      } catch (e) {
        alert("Failed to update quantity");
      }
    }

    async function removeItem(productId) {
      try {
        await api(`/cart/items/${productId}`, {
          method: "DELETE"
        });
        await loadCart();
        await updateCartBadge();
      } catch (e) {
        alert("Failed to remove item");
      }
    }

    function updateSummary(subtotal) {
      const shipping = subtotal > 0 ? 0 : 0;
      const taxRate = 0.08;
      const tax = Math.round(subtotal * taxRate * 100) / 100;
      const total = subtotal + shipping + tax;

      document.getElementById("order-subtotal").textContent = `Subtotal: $${subtotal}`;
      document.getElementById("order-shipping").textContent = `Shipping: $${shipping}`;
      document.getElementById("order-tax").textContent = `Tax: $${tax}`;
      document.getElementById("order-total").textContent = `Total: $${total}`;
    }

    async function openCart() {
      const modal = document.getElementById("cartModal");
      modal.style.display = "block";
      await loadCart();
    }

    function closeCart() {
      document.getElementById("cartModal").style.display = "none";
    }

    // product detail modal state
    let currentProductId = null;

    function setupProductCards() {
      const cards = document.querySelectorAll(".product-card");
      cards.forEach(card => {
        card.addEventListener("click", () => {
          const id = card.dataset.id;
          const name = card.dataset.name;
          const price = card.dataset.price;
          const img = card.querySelector("img").src;
          openProductModal({ id, name, price, img });
        });
      });
    }

    function openProductModal(product) {
      currentProductId = product.id;

      document.getElementById("modalProductName").textContent = product.name;
      document.getElementById("modalProductPrice").textContent = "$" + product.price;
      document.getElementById("modalProductImage").src =
        product.img || productImages[product.id] || "https://via.placeholder.com/220?text=Item";
      document.getElementById("productQty").value = 1;

      document.getElementById("productModal").style.display = "block";
    }

    function closeProductModal() {
      document.getElementById("productModal").style.display = "none";
    }

    async function addCurrentProductToCart() {
      const qty = parseInt(document.getElementById("productQty").value) || 1;
      if (!currentProductId) return;
      await myItem(currentProductId, qty);
      closeProductModal();
    }

    window.onclick = function(event) {
      const cartModal = document.getElementById("cartModal");
      const productModal = document.getElementById("productModal");
      if (event.target === cartModal) {
        closeCart();
      }
      if (event.target === productModal) {
        closeProductModal();
      }
    };

    // Add item to cart from product list
    async function myItem(itemName, qty = 1) {
      try {
        await api("/cart/items", {
          method: "POST",
          body: JSON.stringify({ productId: itemName, qty: qty })
        });
        alert(itemName + " added to cart");
        await updateCartBadge();
      } catch (e) {
        alert("Add failed");
      }
    }

    // Checkout 
    async function checkout() {
      try {
        const order = await api("/orders", { method: "POST" });
        await api("/payments/mock", {
          method: "POST",
          body: JSON.stringify({ orderId: order.id })
        });
        alert(`Order placed successfully! Order ID: ${order.id}\nTotal: $${order.total}`);
        closeCart();
        await updateCartBadge();
      } catch (e) {
        alert("Checkout failed: " + e.message);
      }
    }

    // init
    updateCartBadge();
    setupProductCards();
  </script>
</body>
</html>
